<script type="text/javascript">
  RED.nodes.registerType("soop_gauge", {
    category: "soop-dashboard",
    color: "rgb(255, 189, 27)",
    defaults: {
      name: {
        value: "",
      },
      label: {
        value: "gauge_name",
      },
      group: {
        type: "soop_group",
        required: true,
      },
      width: {
        value: 0,
      },
      height: {
        value: 0,
      },
      gType: { value: "gauge" },
      format: { value: "{{value}}" },
      units: {
        value: "",
      },
      colorPicking: {
        value: "blue",
      },
      min: {
        value: 0,
        required: true,
        validate: RED.validators.number(),
      },
      max: {
        value: 100,
        required: true,
        validate: RED.validators.number(),
      },
    },
    inputs: 1,
    inputLabels: function () {
      return this.min + " - " + this.max;
    },
    icon: "gauge.png",
    outputLabels: function () {
      return this.min + " - " + this.max;
    },
    label: function () {
      return this.name || (~this.label.indexOf("{{") ? null : this.label) || "new_gauge";
    },
    labelStyle: function () {
      return this.name ? "node_label_italic" : "";
    },
    oneditprepare: function () {
      if (this.gType === undefined) {
        this.gType = "gauge";
        $("#node-input-gtype").val("gauge");
      }

      if (this.colorPicking === undefined) {
        this.colorPicking = "blue";
        $("input[type=radio][name=colorPicking]")[0].checked = true;
      }

      $("#node-input-size").elementSizer({
        width: "#node-input-width",
        height: "#node-input-height",
        group: "#node-input-group",
      });

      let pickers = $("input[type=radio][name=colorPicking]");
      for (var i = 0; i < pickers.length; i++) {
        if (pickers[i].value == this.colorPicking) pickers[i].checked = true;
      }
    },
    oneditsave: function () {
      this.colorPicking = $("input[type=radio][name=colorPicking]:checked")[0].value;
    },
  });
</script>

<script type="text/html" data-template-name="soop_gauge">
  <div class="form-row">
    <label for="node-input-group"><i class="fa fa-table"></i> Group</label>
    <input type="text" id="node-input-group" />
  </div>
  <div class="form-row">
    <label><i class="fa fa-object-group"></i> Size</label>
    <input type="hidden" id="node-input-width" />
    <input type="hidden" id="node-input-height" />
    <button class="editor-button" id="node-input-size"></button>
  </div>
  <div class="form-row">
    <label for="node-input-gType"><i class="fa fa-list"></i> Type</label>
    <select id="node-input-gType">
      <option value="gauge">Gauge</option>
      <option value="donut">Donut</option>
      <option value="compass">Compass</option>
      <option value="level">Level</option>
    </select>
  </div>
  <div class="form-row">
    <label for="node-input-label"><i class="fa fa-i-cursor"></i> Label</label>
    <input type="text" id="node-input-label" />
  </div>
  <div class="form-row">
    <label for="node-input-format"><i class="fa fa-i-cursor"></i> Value format</label>
    <input type="text" id="node-input-format" placeholder="{{value}}" />
  </div>
  <div class="form-row">
    <label for="node-input-units"><i class="fa fa-i-cursor"></i> Units</label>
    <input type="text" id="node-input-units" placeholder="%" />
  </div>
  <div class="form-row">
    <label for="node-input-min"><i class="fa fa-arrows-h"></i> Range</label>
    <span for="node-input-min">min</span>
    <input type="text" id="node-input-min" style="width:60px" />
    <span for="not-input-max" style="margin-left:22px;">max</span>
    <input type="text" id="node-input-max" style="width:60px" />
  </div>
  <div class="form-row">
    <label for="node-input-color"><i class="fa fa fa-tint"></i> Color</label>
    <input type="radio" name="colorPicking" id="colorPicking1" style="width: 0px;" value="blue" />
    <label class="styled1" for="colorPicking1" style="width: 60px;text-align: center;">blue</label>
    <input type="radio" name="colorPicking" id="colorPicking2" style="width: 0px;" value="orange" />
    <label class="styled2" for="colorPicking2" style="width: 60px;text-align: center;"
      >orange</label
    >
    <input type="radio" name="colorPicking" id="colorPicking3" style="width: 0px;" value="pink" />
    <label class="styled3" for="colorPicking3" style="width: 60px;text-align: center;">pink</label>
    <input type="radio" name="colorPicking" id="colorPicking4" style="width: 0px;" value="purple" />
    <label class="styled4" for="colorPicking4" style="width: 60px;text-align: center;"
      >purple</label
    >
    <input type="radio" name="colorPicking" id="colorPicking5" style="width: 0px;" value="green" />
    <label class="styled5" for="colorPicking5" style="width: 60px;text-align: center;">green</label>
  </div>
  <div class="form-row">
    <label for="node-input-name"><i class="fa fa-tag"></i> Name</label>
    <input type="text" id="node-input-name" />
  </div>
</script>

<script type="text/html" data-help-name="soop_gauge">
  <p>Adds a gauge type widget to the user interface.</p>
  <p>
    The <code>msg.payload</code> is searched for a numeric <i>value</i> and is formatted in
    accordance with the defined <b>Value Format</b>.
  </p>
  <p>The gauge has several modes. Regular gauge, donut, compass and wave.</p>
  <p>These gauges are drawn by Chart.js.</p>
</script>
