<style>
  input[type="radio"] {
    opacity: 0;
  }
  input[type="radio"] + label {
    border: none;
    color: white;
    border-radius: 5px;
  }
  input[type="radio"]:checked + label {
    border: 3px solid #fd5988;
  }
  .styled1 {
    background: #1153fc;
  }
  .styled2 {
    background: #ff7e42;
  }
  .styled3 {
    background: #fd5988;
  }
  .styled4 {
    background: #8443f6;
  }
  .styled5 {
    background: #08C792;
  }
</style>
<script type="text/javascript">
  RED.nodes.registerType("soop_slider", {
    /* Node definitions
     *  category: palette category
     *  color: background color
     *  defaults: node property
     *  inputs: # of input
     *  outputs: # of output
     *  icon: icon image
     *  paletteLabel: node name in palette
     *  label: function that returns value for the label name
     *  labelstyle: function that returns css-style for the label
     *  oneditprepare: function called when edit window is opened
     *  oneditsave: function called when edit window is okayed
     */
    category: "soop-dashboard",
    color: "rgb(100, 189, 27)",
    defaults: {
      /* Node Properties (value, required, validate, type)
       *  name: node name on palette
       *  label: node label on dashboard
       *  group: group information of the node
       *  width, height: size of node
       *  min, max, step: property of slider
       *  colorPicking: color of node in dashboard
       *  pass: boolean option for whether pass input or not
       *  send: option for when to send msg through flow
       */
      name: { value: "" },
      label: { value: "" },
      tooltip: { value: "" },
      group: {
        type: "ui_group",
        required: true,
      },
      width: {
        value: 0,
        validate: function (v) {
          var width = v || 0;
          var currentGroup = $("#node-input-group").val() || this.group;
          var groupNode = RED.nodes.node(currentGroup);
          var valid = !groupNode || +width <= +groupNode.width;
          $("#node-input-size").toggleClass("input-error", !valid);
          return valid;
        },
      },
      height: {
        value: 0,
      },
      min: {
        value: 0,
        required: true,
        validate: RED.validators.number(),
      },
      max: {
        value: 100,
        required: true,
        validate: RED.validators.number(),
      },
      step: {
        value: 1,
        required: true,
        validate: RED.validators.number(),
      },
      colorPicking: {
        value: "blue",
      },
      pass: { value: true },
      send: { value: "always" },
    },
    inputs: 1,
    outputs: 1,
    icon: "font-awesome/fa-sliders",
    paletteLabel: "soop_slider",
    label: function () {
      return this.name || "soop_slider";
    },
    oneditprepare: function () {
      $("#node-input-size").elementSizer({
        width: "#node-input-width",
        height: "#node-input-height",
        group: "#node-input-group",
      });

      if (!$("#node-input-send").val()) {
        $("#node-input-send").val("always");
      }

      // Check input radio form according to picked color
      var colors = $("input[type=radio][name=colorPicking]");

      for(const item of colors){
        if(item.value === this.colorPicking){
          item.checked = true;
          break;
        }
      }
    },
    oneditsave: function () {
      this.colorPicking = $("input[type=radio][name=colorPicking]:checked")[0].value;
    },
  });
</script>

<script type="text/html" data-template-name="soop_slider">
  <!-- Group -->
  <div class="form-row">
    <label for="node-input-group"><i class="fa fa-table"></i> Group</label>
    <input type="text" id="node-input-group" />
  </div>
  <!-- Size -->
  <div class="form-row">
    <label><i class="fa fa-object-group"></i> Size</label>
    <input type="hidden" id="node-input-width" />
    <input type="hidden" id="node-input-height" />
    <button class="editor-button" id="node-input-size"></button>
  </div>
  <!-- Color -->
  <div class="form-row">
    <label for="node-input-color"><i class="fa fa fa-tint"></i> Color</label>
    <input type="radio" name="colorPicking" id="colorPicking1" style="width: 0px;" value="blue" />
    <label class="styled1" for="colorPicking1" style="width: 60px;text-align: center;">blue</label>
    <input type="radio" name="colorPicking" id="colorPicking2" style="width: 0px;" value="orange" />
    <label class="styled2" for="colorPicking2" style="width: 60px;text-align: center;">orange</label>
    <input type="radio" name="colorPicking" id="colorPicking3" style="width: 0px;" value="pink" />
    <label class="styled3" for="colorPicking3" style="width: 60px;text-align: center;">pink</label>
    <input type="radio" name="colorPicking" id="colorPicking4" style="width: 0px;" value="purple" />
    <label class="styled4" for="colorPicking4" style="width: 60px;text-align: center;">purple</label>
    <input type="radio" name="colorPicking" id="colorPicking5" style="width: 0px;" value="green" />
    <label class="styled5" for="colorPicking5" style="width: 60px;text-align: center;">green</label>
  </div>
  <!-- Label -->
  <div class="form-row">
    <label for="node-input-label"><i class="fa fa-i-cursor"></i> Label</label>
    <input type="text" id="node-input-label" />
  </div>
  <!-- Tooltip -->
  <div class="form-row">
    <label for="node-input-tooltip"><i class="fa fa-info-circle"></i> Tooltip</label>
    <input type="text" id="node-input-tooltip" placeholder="optional tooltip" />
  </div>
  <!-- Range -->
  <div class="form-row">
    <label for="node-input-min"><i class="fa fa-arrows-h"></i> Range</label>
    <span for="node-input-min">min</span>
    <input type="text" id="node-input-min" style="width:60px" />
    <span for="not-input-max" style="margin-left:22px;">max</span>
    <input type="text" id="node-input-max" style="width:60px" />
    <span for="not-input-step" style="margin-left:22px;">step</span>
    <input type="text" id="node-input-step" style="width:60px" />
  </div>
  <!-- Pass -->
  <div class="form-row">
    <label style="width:auto" for="node-input-pass"
      ><i class="fa fa-arrow-right"></i> If <code>msg</code> arrives on input, pass through to output:
    </label>
    <input type="checkbox" checked id="node-input-pass" style="display:inline-block; width:auto; vertical-align:top;" />
  </div>
  <!-- Send -->
  <div class="form-row">
    <label style="width:auto" for="node-input-payload"><i class="fa fa-envelope-o"></i> Send <code>msg</code></label>
  </div>
  <div class="form-row">
    <label style="padding-left:25px; margin-right:-25px" for="node-input-send">When</label>
    <select id="node-input-send" style="width:204px">
      <option value="always">always value changed</option>
      <option value="release">only after slider released</option>
    </select>
  </div>
  <div class="form-row">
    <label style="padding-left:25px; margin-right:-25px">Payload</label>
    <label style="width:auto">Current value</label>
  </div>
  <!-- Name -->
  <div class="form-row">
    <label for="node-input-name"><i class="fa fa-tag"></i> Name</label>
    <input type="text" id="node-input-name" />
  </div>
</script>

<script type="text/html" data-help-name="soop_slider">
  <p>Adds a slider on the dashboard</p>
  <h3>Inputs</h3>
    <dl class="message-properties">
        <dt>payload <span class="property-type">number</span></dt>
        <dd> the payload of the message </dd>
    </dl>

  <h3>Outputs</h3>    
    <dl class="message-properties">
        <dt>payload <span class="property-type">number</span></dt>
        <dd> the payload of the message. </dd>
    </dl>  

  <h3>Details</h3>
  <ol class="node-ports">
    <li>Slider Range
        <dl class="message-properties">
            <dt>min, max, step <span class="property-type">number</span></dt>
            <dd>Minimum, maximum, interval value of the slider.</dd>
        </dl>
    </li>
    <li>Forward Input
        <dl class="message-properties">
            <dt>pass <span class="property-type">boolean</span></dt>
            <dd>Option for forwarding input msg or not, when input arrives.</dd>
        </dl>
    </li>
    <li>Send Payload
      <dl class="message-properties">
          <dt>send <span class="property-type">always | release</span></dt>
          <dd>Option for receiving modified value from the dashboard.</dd>
          <dd>Send received value whenever the slider value changed or when the user releases the slider.</dd>
      </dl>
    </li>
  </ol>
  <!--
    <p>A vertical slider can be created by setting the size so that the height is greater than the width.</p>
    <p>The slider can be reversed by setting the min value larger than the max value.</p>
    <p>An input <code>msg.payload</code> will be converted to a number. The <b>min</b> value will be used if conversion fails.</p>
  -->

  <h3>References</h3>
    <ul>
      <li><a href="https://fontawesome.com/v4/icons/">FontAwesome</a> - the icon on a button</li>
    </ul>
</script>
